#!/usr/bin/env bash
# ============================================================================
# VLESS Menu - Manajemen akun VLESS XRAY
# ============================================================================

# Source library functions
if [[ -f /usr/bin/vpn-lib.sh ]]; then
  # shellcheck disable=SC1091
  source /usr/bin/vpn-lib.sh
else
  echo "ERROR: Library /usr/bin/vpn-lib.sh tidak ditemukan!"
  exit 1
fi

# -----------------------------
# Sub-menu: VLESS (XRAY)
# -----------------------------
vless_menu() {
  local proto="VLESS"
  while true; do
    print_header
    render_dashboard

    cat <<EOF
${C_BOLD}${C_YELLOW}${proto} MANAGEMENT MENU (XRAY)${C_RESET}

 SERVICE STATUS: $(fmt_onoff "$(svc_is_active xray)")

 MANAGEMENT OPTIONS:
 [1] Add ${proto} Account
 [2] Delete ${proto} Account
 [3] Renew ${proto} Account
 [4] List ${proto} Accounts

 [0] Back to Main Menu

${C_DIM}Note:${C_RESET}
- Implementasikan CRUD akun dengan mengedit /etc/xray/config.json
- Setelah perubahan, restart XRAY: systemctl restart xray
EOF

    read -r -p "Select: " opt
    case "$opt" in
      1|2|3|4)
        echo
        echo "${C_YELLOW}[INFO]${C_RESET} ${proto} account management belum diaktifkan."
        echo "Silakan sesuaikan dengan format config XRAY Anda."
        pause
        ;;
      0) return 0 ;;
      *) echo "${C_RED}[ERROR]${C_RESET} Pilihan tidak valid."; pause ;;
    esac
  done
}

# Main entry point
main() {
  require_root
  vless_menu
}

main "$@"
